<!-- Mafia Page -->
<div class="container" id="mafiaPage">
  <h2>Mafia Game</h2>

  <!-- Setup -->
  <div id="mafiaSetup">
    <input type="text" id="playerName" placeholder="Enter player name">
    <button onclick="addPlayer()">Add Player</button>
    <ul id="playerList"></ul>
    <button onclick="assignRoles()">Assign Roles</button>
  </div>

  <!-- Role Reveal Phase -->
  <div id="roleReveal" style="display:none;">
    <h3 id="currentPlayerName"></h3>
    <button id="revealBtn" onclick="revealRole()">Reveal Role</button>
    <p id="roleText" style="display:none; font-weight:bold; font-size:18px;"></p>
    <button id="nextPlayerBtn" style="display:none;" onclick="nextPlayer()">Hide Role / Next</button>
  </div>

  <!-- Game Phase -->
  <div id="mafiaGame" style="display:none;">
    <h3 id="phaseTitle">Night Phase</h3>
    <p id="instructions">Pass the phone to the Mafia...</p>
    <button onclick="nextPhase()">Next</button>
  </div>

  <button onclick="showPage('homePage')">Back</button>
  <div id="footer">App by Evan</div>
</div>

<script>
let players = [];
let roles = {};
let roleList = ["Mafia","Detective","Doctor"]; 
let currentPlayerIndex = 0;

function addPlayer() {
  let name = document.getElementById("playerName").value.trim();
  if (name) {
    players.push(name);
    let li = document.createElement("li");
    li.textContent = name;
    document.getElementById("playerList").appendChild(li);
    document.getElementById("playerName").value = "";
  }
}

function assignRoles() {
  if (players.length < 4) { alert("Need at least 4 players!"); return; }
  
  let shuffled = [...players].sort(()=>0.5-Math.random());
  roles = {};
  roles[shuffled[0]] = "Mafia";
  roles[shuffled[1]] = "Detective";
  roles[shuffled[2]] = "Doctor";
  for (let i=3;i<shuffled.length;i++) roles[shuffled[i]]="Villager";
  
  // Switch to role reveal phase
  document.getElementById("mafiaSetup").style.display="none";
  document.getElementById("roleReveal").style.display="block";
  currentPlayerIndex = 0;
  showCurrentPlayer();
}

function showCurrentPlayer() {
  document.getElementById("roleText").style.display = "none";
  document.getElementById("nextPlayerBtn").style.display = "none";
  document.getElementById("revealBtn").style.display = "inline-block";
  document.getElementById("currentPlayerName").textContent = players[currentPlayerIndex] + ", tap to reveal your role";
}

function revealRole() {
  let player = players[currentPlayerIndex];
  document.getElementById("roleText").textContent = "Your role: " + roles[player];
  document.getElementById("roleText").style.display = "block";
  document.getElementById("revealBtn").style.display = "none";
  document.getElementById("nextPlayerBtn").style.display = "inline-block";
}

function nextPlayer() {
  currentPlayerIndex++;
  if (currentPlayerIndex < players.length) {
    showCurrentPlayer();
  } else {
    // All players have seen roles â†’ start Mafia game
    document.getElementById("roleReveal").style.display="none";
    document.getElementById("mafiaGame").style.display="block";
    document.getElementById("phaseTitle").textContent="Night Phase";
    document.getElementById("instructions").textContent="Mafia, pick someone to eliminate.";
  }
}

function startMafiaGame() {
  document.getElementById("roleReveal").style.display="none";
  document.getElementById("mafiaGame").style.display="block";
}

function nextPhase() {
  if (document.getElementById("phaseTitle").textContent=="Night Phase") {
    document.getElementById("phaseTitle").textContent="Day Phase";
    document.getElementById("instructions").textContent="Everyone votes to eliminate a suspect.";
  } else {
    document.getElementById("phaseTitle").textContent="Night Phase";
    document.getElementById("instructions").textContent="Mafia, pick someone to eliminate.";
  }
}
</script>
